# Win-forwarding-events
Скрипт для настройки машины для WinEventLog или пересылки событий на WEC
Пересылка событий на WEC (работает только если машины в домене).
Так как скрипт использует русские буквы, необходимо проверить его кодировку. Она должна быть юникод.
Для корректной работы скрипта нужно заполнить данные. 

Адрес Windows Event Collector. Необходим настройки для пересылки на WEC
$serverAddress = "wec.local.dom" 

Имя учетной записи для MP 10 Collector. С ее помощью Collector (agent) будет собирать логи. Дан­ные этой учет­ной за­пи­си нуж­но ука­зать при до­бав­ле­нии учет­ной за­пи­си в MaxPatrol SIEM.
$mp10collector = 'Администратор' 

Интервал обновления подписки. Измеряется в секундах.
$refreshInterval = 600           

# 1. Настройка политики аудита с помощью утилиты auditpol

Подробнее о всех параметрах аудита можно ознакомиться по ссылке: https://help.ptsecurity.com/ru-RU/projects/mp10/27.2/help/1083632139

auditpol /set /subcategory:"{0CCE9241-69AE-11D9-BED3-505054503030}" /success:disable /failure:enable
	
название категории и подкатегории указаны в виде GUID. Чтобы посмотреть список всех GUID для аудита, можно воспользоваться командой:
auditpol /list /subcategory:* /v 


# 2. Настройка службы WinRM
winrm quickconfig -q

И немного проверки на работоспособность службы.

# 3. Включение правил межсетевого экрана для удаленного управления журналом событий

После включение автонастройки службы WinRM, в брандмауре создается правило, которое открывает порт 5985. Нужно проверить, точно ли порт открыт. Если открыт, то пропускается создание, если нет, то добавляется новое 

# 4. Настройка пересылки событий на WEC 
Если ранее было дано подтверждение для этого действия, то добавляется в реестр запись с информацией по пересылке событий (с введенным выше адресом wec), ну и разрешается доступ до журнала Security.
Если пользователь отказался, то включаются дополнительно правила бранмауэра и доступ до журнала Security для учетной записи MP 10 Collector. Необходимо заранее создать такую учетную запись на машине. Подробнее : https://help.ptsecurity.com/ru-RU/projects/mp10/27.2/help/1109335563




Дополнительно, если запускать в ISE, консоль может выдавать брэд. Чтобы исправить кодировку в консоли, можно воспользоваться одной из этих команд:
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8

[Console]::OutputEncoding = [System.Text.Encoding]::GetEncoding("utf-8")

[Console]::outputEncoding = [System.Text.Encoding]::GetEncoding('cp866')
